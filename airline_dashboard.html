<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Airline Dataset Dashboard</title>
<style>
  :root {
    --bg:#0f172a;
    --card:#111827;
    --muted:#94a3b8;
    --text:#e5e7eb;
    --accent:#22c55e;
    --accent2:#3b82f6;
    --danger:#ef4444;
    --chip:#1f2937;
    --border:#374151;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    background:linear-gradient(180deg,#0b1220,#0f172a);
    color:var(--text);
  }
  header{
    padding:24px 20px 10px;
    border-bottom:1px solid var(--border);
    position:sticky;top:0;background:rgba(15,23,42,0.9);backdrop-filter: blur(6px);
  }
  h1{margin:0;font-weight:700;letter-spacing:.2px}
  .subtitle{color:var(--muted);margin-top:6px}
  .wrap{max-width:1200px;margin:0 auto;padding:18px 20px 40px;}
  .controls{
    display:grid;grid-template-columns:repeat(12,1fr);gap:12px;margin:16px 0 10px;
  }
  .control{grid-column: span 3;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:10px 12px}
  .control label{display:block;font-size:.8rem;color:var(--muted);margin-bottom:6px}
  .control input,.control select{
    width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#0b1020;color:var(--text);
    outline:none;
  }
  .control.checkbox{display:flex;align-items:center;gap:10px;padding:12px}
  .control.checkbox label{margin:0}
  .row{display:flex;gap:10px;align-items:center}
  .btn{
    background:var(--accent2);color:white;border:none;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600;
  }
  .btn.secondary{background:#1f2937}
  .btn.danger{background:var(--danger)}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .grid{
    display:grid;grid-template-columns:repeat(12,1fr);gap:12px;margin:14px 0 20px;
  }
  .card{
    grid-column: span 3;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;
  }
  .card h3{margin:0 0 6px 0;font-size:.95rem;color:var(--muted);font-weight:600}
  .kpi{font-size:1.6rem;font-weight:800}
  .pill{display:inline-block;background:var(--chip);border:1px solid var(--border);padding:4px 8px;border-radius:999px;color:var(--muted);font-size:.8rem}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  thead th{font-size:.85rem;color:var(--muted);text-align:left;padding:6px 10px}
  tbody tr{
    background:var(--card);border:1px solid var(--border);
  }
  tbody td{
    padding:12px 10px;border-top:1px solid var(--border);border-bottom:1px solid var(--border);
  }
  tbody tr td:first-child{border-left:1px solid var(--border);border-top-left-radius:12px;border-bottom-left-radius:12px}
  tbody tr td:last-child{border-right:1px solid var(--border);border-top-right-radius:12px;border-bottom-right-radius:12px}
  .name{font-weight:700}
  .tag{font-size:.75rem;padding:3px 8px;border-radius:999px;border:1px solid var(--border);background:#0b1020;color:var(--muted)}
  .footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
  .pagination{display:flex;gap:8px;align-items:center}
  .muted{color:var(--muted);font-size:.9rem}
  dialog{border:none;border-radius:16px;padding:0;background:transparent}
  dialog::backdrop{background:rgba(0,0,0,.5);backdrop-filter: blur(2px)}
  .modal{background:var(--card);border:1px solid var(--border);border-radius:16px;max-width:720px;width:92vw;padding:18px}
  .modal h2{margin:0 0 8px}
  .modal .grid{grid-template-columns:repeat(6,1fr)}
  .copy{cursor:pointer}
  @media (max-width:980px){
    .control{grid-column: span 6}
    .card{grid-column: span 6}
  }
  @media (max-width:680px){
    .control{grid-column: span 12}
    .card{grid-column: span 12}
  }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Airline Dataset Dashboard</h1>
    <div class="subtitle">Interactive filtering, quick stats, and detailed views. Make sure <code>airlineData.json</code> is in the same folder.</div>
  </div>
</header>

<main class="wrap">
  <!-- Controls -->
  <section class="controls">
    <div class="control" style="grid-column:span 4">
      <label for="q">Airline name (starts with)</label>
      <input id="q" type="text" placeholder="e.g., Titan, Smartwings, Air ..." />
    </div>
    <div class="control">
      <label for="country">Country</label>
      <select id="country"><option value="">All</option></select>
    </div>
    <div class="control">
      <label for="subregion">Subregion</label>
      <select id="subregion"><option value="">All</option></select>
    </div>
    <div class="control">
      <label for="type">Type</label>
      <select id="type"><option value="">All</option></select>
    </div>
    <div class="control">
      <label for="status">Status</label>
      <select id="status"><option value="">All</option></select>
    </div>
    <div class="control">
      <label for="category">Category</label>
      <select id="category"><option value="">All</option></select>
    </div>
    <div class="control checkbox">
      <input id="hasFleet" type="checkbox"/>
      <label for="hasFleet">Has fleet data</label>
    </div>
    <div class="control">
      <label>&nbsp;</label>
      <button class="btn" id="btnExport">Export filtered to CSV</button>
    </div>
  </section>

  <!-- KPIs -->
  <section class="grid" id="kpis">
    <div class="card"><h3>Total airlines</h3><div class="kpi" id="kpiTotal">-</div></div>
    <div class="card"><h3>Active</h3><div class="kpi" id="kpiActive">-</div></div>
    <div class="card"><h3>Countries covered</h3><div class="kpi" id="kpiCountries">-</div></div>
    <div class="card"><h3>Charter / Scheduled / VIP</h3><div class="kpi"><span id="kpiCharter">-</span> <span class="muted">/</span> <span id="kpiScheduled">-</span> <span class="muted">/</span> <span id="kpiVIP">-</span></div></div>
  </section>

  <!-- Table -->
  <section>
    <div class="footer">
      <div class="muted" id="countLabel">0 results</div>
      <div class="pagination">
        <button class="btn secondary" id="prev">Prev</button>
        <span class="pill" id="pageLabel">1 / 1</span>
        <button class="btn secondary" id="next">Next</button>
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>IATA</th>
          <th>ICAO</th>
          <th>Type</th>
          <th>Status</th>
          <th>Country</th>
          <th>Subregion</th>
          <th>Category</th>
          <th>Base</th>
          <th>Fleet</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </section>
</main>

<dialog id="dlg">
  <div class="modal">
    <div class="row" style="justify-content:space-between">
      <h2 id="dlgTitle">Airline details</h2>
      <button class="btn danger" onclick="dlg.close()">Close</button>
    </div>
    <div class="grid">
      <div class="card" style="grid-column:span 3">
        <h3>Codes</h3>
        <div>IATA: <strong id="dIata">-</strong></div>
        <div>ICAO: <strong id="dIcao">-</strong></div>
      </div>
      <div class="card" style="grid-column:span 3">
        <h3>Status</h3>
        <div><span id="dStatus" class="tag">-</span></div>
      </div>
      <div class="card" style="grid-column:span 3">
        <h3>Location</h3>
        <div id="dCountry">-</div>
        <div id="dSubregion" class="muted">-</div>
        <div id="dBase" class="muted">-</div>
      </div>
      <div class="card" style="grid-column:span 3">
        <h3>Category / Type</h3>
        <div id="dCategory">-</div>
        <div id="dType" class="muted">-</div>
      </div>
      <div class="card" style="grid-column:span 6">
        <h3>Fleet</h3>
        <div id="dFleetList" class="muted">-</div>
      </div>
    </div>
    <div class="row" style="justify-content:flex-end;gap:8px;margin-top:10px">
      <button class="btn secondary" id="copyBtn">Copy details</button>
    </div>
  </div>
</dialog>

<script>
const state = {
  data: [],
  filtered: [],
  page: 1,
  pageSize: 20
};

const els = {
  q: document.getElementById('q'),
  country: document.getElementById('country'),
  subregion: document.getElementById('subregion'),
  type: document.getElementById('type'),
  status: document.getElementById('status'),
  category: document.getElementById('category'),
  hasFleet: document.getElementById('hasFleet'),
  rows: document.getElementById('rows'),
  countLabel: document.getElementById('countLabel'),
  pageLabel: document.getElementById('pageLabel'),
  prev: document.getElementById('prev'),
  next: document.getElementById('next'),
  // KPIs
  kTotal: document.getElementById('kpiTotal'),
  kActive: document.getElementById('kpiActive'),
  kCountries: document.getElementById('kpiCountries'),
  kCharter: document.getElementById('kpiCharter'),
  kScheduled: document.getElementById('kpiScheduled'),
  kVIP: document.getElementById('kpiVIP'),
  // Modal
  dlg: document.getElementById('dlg'),
  dTitle: document.getElementById('dlgTitle'),
  dIata: document.getElementById('dIata'),
  dIcao: document.getElementById('dIcao'),
  dStatus: document.getElementById('dStatus'),
  dCountry: document.getElementById('dCountry'),
  dSubregion: document.getElementById('dSubregion'),
  dBase: document.getElementById('dBase'),
  dCategory: document.getElementById('dCategory'),
  dType: document.getElementById('dType'),
  dFleetList: document.getElementById('dFleetList'),
  copyBtn: document.getElementById('copyBtn'),
  btnExport: document.getElementById('btnExport')
};

// Debounce helper
function debounce(fn, ms=200){
  let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); };
}

// Load JSON
async function load(){
  try{
    const res = await fetch('airlineData.json', {cache:'no-store'});
    if(!res.ok) throw new Error('Fetch failed');
    const json = await res.json();
    state.data = Array.isArray(json) ? json : (json.airlines || []);
    setupFilters();
    applyFilters();
    renderKPIs(state.filtered);
  }catch(e){
    console.error(e);
    alert('Could not load airlineData.json. Place it next to this HTML and ensure the filename matches.');
  }
}

function uniqueSorted(arr){
  return [...new Set(arr.filter(Boolean))].sort((a,b)=>a.localeCompare(b));
}

function setupFilters(){
  const countries = uniqueSorted(state.data.map(d=>d.country));
  const subregions = uniqueSorted(state.data.map(d=>d.subregion));
  const types = uniqueSorted(state.data.map(d=>d.type));
  const statuses = uniqueSorted(state.data.map(d=>d.status));
  const categories = uniqueSorted(state.data.map(d=>d.category));

  for(const val of countries){ const o=document.createElement('option'); o.value=o.textContent=val; els.country.appendChild(o); }
  for(const val of subregions){ const o=document.createElement('option'); o.value=o.textContent=val; els.subregion.appendChild(o); }
  for(const val of types){ const o=document.createElement('option'); o.value=o.textContent=val; els.type.appendChild(o); }
  for(const val of statuses){ const o=document.createElement('option'); o.value=o.textContent=val; els.status.appendChild(o); }
  for(const val of categories){ const o=document.createElement('option'); o.value=o.textContent=val; els.category.appendChild(o); }

  els.q.addEventListener('input', debounce(()=>{ state.page=1; applyFilters(); }, 250));
  [els.country, els.subregion, els.type, els.status, els.category, els.hasFleet].forEach(el=>{
    el.addEventListener('change', ()=>{ state.page=1; applyFilters(); });
  });
  els.prev.addEventListener('click', ()=>{ if(state.page>1){ state.page--; render(); } });
  els.next.addEventListener('click', ()=>{
    const pages = Math.max(1, Math.ceil(state.filtered.length/state.pageSize));
    if(state.page<pages){ state.page++; render(); }
  });
  els.btnExport.addEventListener('click', exportCSV);
}

function applyFilters(){
  const q = els.q.value.trim().toLowerCase();
  const country = els.country.value;
  const subregion = els.subregion.value;
  const type = els.type.value;
  const status = els.status.value;
  const category = els.category.value;
  const hasFleet = els.hasFleet.checked;

  state.filtered = state.data.filter(d=>{
    const nameMatch = !q || (d.name || '').toLowerCase().startsWith(q);
    const ctryMatch = !country || d.country===country;
    const subrMatch = !subregion || d.subregion===subregion;
    const typeMatch = !type || d.type===type;
    const statusMatch = !status || d.status===status;
    const catMatch = !category || d.category===category;
    const fleetMatch = !hasFleet || (Array.isArray(d.fleet) && d.fleet.length>0);
    return nameMatch && ctryMatch && subrMatch && typeMatch && statusMatch && catMatch && fleetMatch;
  });

  render();
}

function renderKPIs(items){
  const total = items.length;
  const active = items.filter(d => d.status === 'Active').length;
  const countries = uniqueSorted(items.map(d => d.country)).length;
  const charter = items.filter(d => (d.type || '').includes('Charter')).length;
  const scheduled = items.filter(d => (d.type || '').includes('Scheduled')).length;
  const vip = items.filter(d => (d.category || '').includes('VIP')).length;
  
  els.kTotal.textContent = total;
  els.kActive.textContent = active;
  els.kCountries.textContent = countries;
  els.kCharter.textContent = charter;
  els.kScheduled.textContent = scheduled;
  els.kVIP.textContent = vip;
}


function render(){
  const start = (state.page-1)*state.pageSize;
  const end = start + state.pageSize;
  const pageItems = state.filtered.slice(start,end);
  els.rows.innerHTML = '';

  pageItems.forEach(d=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="name"><button class="btn secondary" style="padding:6px 10px" data-name="${escapeHtml(d.name||'')}">${escapeHtml(d.name||'-')}</button></td>
      <td>${escapeHtml(d.iata||'-')}</td>
      <td>${escapeHtml(d.icao||'-')}</td>
      <td><span class="tag">${escapeHtml(d.type||'-')}</span></td>
      <td>${escapeHtml(d.status||'-')}</td>
      <td>${escapeHtml(d.country||'-')}</td>
      <td>${escapeHtml(d.subregion||'-')}</td>
      <td>${escapeHtml(d.category||'-')}</td>
      <td>${escapeHtml(d.base||'-')}</td>
      <td>${Array.isArray(d.fleet)? d.fleet.length : 0}</td>
    `;
    tr.querySelector('button').addEventListener('click', ()=>openDialog(d));
    els.rows.appendChild(tr);
  });

  els.countLabel.textContent = `${state.filtered.length} results`;
  const pages = Math.max(1, Math.ceil(state.filtered.length/state.pageSize));
  els.pageLabel.textContent = `${state.page} / ${pages}`;

  renderKPIs(state.filtered);
}

function openDialog(d){
  els.dTitle.textContent = d.name || '-';
  els.dIata.textContent = d.iata || '-';
  els.dIcao.textContent = d.icao || '-';
  els.dStatus.textContent = d.status || '-';
  els.dCountry.textContent = d.country || '-';
  els.dSubregion.textContent = d.subregion || '-';
  els.dBase.textContent = d.base || '-';
  els.dCategory.textContent = d.category || '-';
  els.dType.textContent = d.type || '-';
  els.dFleetList.textContent = Array.isArray(d.fleet) && d.fleet.length ? d.fleet.join(', ') : 'No fleet data';
  els.copyBtn.onclick = ()=>{
    const text = `Airline: ${d.name}
IATA/ICAO: ${d.iata||'-'} / ${d.icao||'-'}
Status: ${d.status||'-'}
Country/Subregion: ${d.country||'-'} / ${d.subregion||'-'}
Base: ${d.base||'-'}
Category/Type: ${d.category||'-'} / ${d.type||'-'}
Fleet: ${Array.isArray(d.fleet)&&d.fleet.length? d.fleet.join(', ') : 'No fleet data'}`;
    navigator.clipboard.writeText(text);
  };
  dlg.showModal();
}

// CSV export
function exportCSV(){
  const headers = ['name','iata','icao','type','status','country','subregion','category','base','numberOfAircraft'];
  const rows = state.filtered.map(d=> headers.map(h=> (d[h]??'')).join(','));
  const csv = [headers.join(','), ...rows].join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'airlines_filtered.csv';
  a.click();
  URL.revokeObjectURL(url);
}

// helpers
function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

// init
load();
</script>
</body>
</html>
